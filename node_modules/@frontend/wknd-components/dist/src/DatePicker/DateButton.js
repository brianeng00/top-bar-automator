"use strict";
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.DateButton = void 0;
var react_1 = __importDefault(require("react"));
var isSameDay_1 = __importDefault(require("date-fns/isSameDay"));
var dayzed_1 = require("dayzed");
var Typography_1 = __importDefault(require("../Typography/Typography"));
var DateButton_styles_1 = require("./DateButton.styles");
var Ellipse_1 = require("./Ellipse");
var getPositionWithHoveredDate = function (firstSelectedDate, hoveredDateTime) {
    if (firstSelectedDate < hoveredDateTime) {
        return "rangeStart";
    }
    if (firstSelectedDate > hoveredDateTime) {
        return "rangeEnd";
    }
    return;
};
var getPositionWithTwoDates = function (firstSelectedDate, secondSelectedDate, selectedDate) {
    if (firstSelectedDate === secondSelectedDate ||
        (0, isSameDay_1.default)(firstSelectedDate, secondSelectedDate)) {
        return;
    }
    if (firstSelectedDate === selectedDate) {
        return "rangeStart";
    }
    if (secondSelectedDate === selectedDate) {
        return "rangeEnd";
    }
    return;
};
var getSelectedDatePosition = function (dateObj, hoveredDate, selected) {
    if (!(selected instanceof Array) || !(selected === null || selected === void 0 ? void 0 : selected.length) || !dateObj.selected) {
        return;
    }
    var firstSelectedDate = selected[0].getTime();
    if (selected.length === 2) {
        var secondSelectedDate = selected[1].getTime();
        var selectedDate = dateObj.date.getTime();
        // we can assume a new date was selected
        if ((0, isSameDay_1.default)(firstSelectedDate, secondSelectedDate) && hoveredDate) {
            var hoveredDateTime = hoveredDate === null || hoveredDate === void 0 ? void 0 : hoveredDate.getTime();
            return getPositionWithHoveredDate(firstSelectedDate, hoveredDateTime);
        }
        else {
            return getPositionWithTwoDates(firstSelectedDate, secondSelectedDate, selectedDate);
        }
    }
    return;
};
var DateButton = function (_a) {
    var hoveredDate = _a.hoveredDate, dateObj = _a.dateObj, dateProps = _a.dateProps, dayzedProps = _a.dayzedProps, isRange = _a.isRange, _b = _a.tabIndex, tabIndex = _b === void 0 ? -1 : _b;
    var getDateProps = (0, dayzed_1.useDayzed)(dayzedProps).getDateProps;
    var selected = dayzedProps.selected;
    var buttonDate = dateObj.date.getDate();
    var isInRange = function (date) {
        if (!(selected instanceof Array) || !(selected === null || selected === void 0 ? void 0 : selected.length)) {
            return false;
        }
        if (selected.length !== 2) {
            return false;
        }
        var firstSelected = selected[0].getTime();
        var selectedDate = date.getTime();
        if ((0, isSameDay_1.default)(selected[0], selected[1])) {
            var hoveredDateTime = hoveredDate === null || hoveredDate === void 0 ? void 0 : hoveredDate.getTime();
            return (hoveredDateTime ? ((firstSelected < selectedDate && hoveredDateTime >= selectedDate) ||
                (selectedDate < firstSelected && selectedDate >= hoveredDateTime)) : false);
        }
        else {
            var secondSelected = selected[1].getTime();
            return firstSelected < selectedDate && secondSelected > selectedDate;
        }
    };
    var getAriaLabel = function () {
        if (dateObj.today) {
            return "Today's Date, ".concat(dateObj.date.toDateString());
        }
        if (isRange && selected instanceof Array && (selected === null || selected === void 0 ? void 0 : selected.length)) {
            var dateTime = dateObj.date.getTime();
            var firstSelected = selected[0].getTime();
            var secondSelected = selected[1] && selected[1].getTime();
            if (firstSelected && secondSelected && (dateTime === firstSelected || dateTime === secondSelected)) {
                // eslint-disable-next-line max-len
                return "Selected start of range ".concat(selected[0].toDateString(), ", selected end of range ").concat(selected[1].toDateString());
            }
            else if (firstSelected < dateTime && secondSelected > dateTime) {
                return "".concat(dateObj.date.toDateString(), " selected");
            }
        }
        return dateObj.date.toDateString();
    };
    return (react_1.default.createElement(DateButton_styles_1.CalendarDateButtonWrapper, { buttonSelected: isRange ? getSelectedDatePosition(dateObj, hoveredDate, selected) : undefined, isSelected: dateObj.selected, key: buttonDate, "data-qa": "".concat(buttonDate, "-calendar-date-button-wrapper"), isToday: dateObj.today },
        react_1.default.createElement(DateButton_styles_1.CalendarDateButton, __assign({ "data-qa": buttonDate, key: buttonDate, selected: dateObj.selected, isInRange: isRange && isInRange(dateObj.date), "data-selected": dateObj.selected }, getDateProps(dateProps), { "aria-label": getAriaLabel(), tabIndex: tabIndex, "data-calendar-button": "calendar-date-button" }),
            react_1.default.createElement(Typography_1.default, { dataQA: "".concat(buttonDate, "-calendar-button-text"), component: "span", variant: dateObj.today ? "bodyCopyBold" : "bodyCopy" }, buttonDate),
            dateObj.today &&
                react_1.default.createElement(Ellipse_1.Ellipse, { isInRange: isRange && isInRange(dateObj.date), selected: dateObj.selected }))));
};
exports.DateButton = DateButton;
//# sourceMappingURL=DateButton.js.map