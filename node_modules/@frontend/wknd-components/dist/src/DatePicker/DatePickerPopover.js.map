{"version":3,"file":"DatePickerPopover.js","sourceRoot":"","sources":["../../../src/DatePicker/DatePickerPopover.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { ReactNode, useEffect, useRef, useState } from \"react\";\nimport { isSameDay } from \"date-fns\";\n\nimport { PointerDownOutsideEvent } from \"@radix-ui/react-dismissable-layer\";\n\nimport { Popover, PopoverMenuProps } from \"../Popover\";\nimport { StyledPopoverProps } from \"../Popover/Popover.types\";\n\nimport { StaticDatePickerProps } from \"./DatePicker.types\";\nimport DatePickerInput, { DatePickerInputProps } from \"./DatePickerInput\";\nimport { DatePickerPopoverContextProvider, DatePickerPopoverContextType } from \"./DatePickerPopoverContext\";\nimport DateRangePickerInput, { DateRangePickerInputProps } from \"./DateRangePickerInput\";\n\n// offset used for the Input triggers\nconst INPUT_OFFSET = 16;\n// offset used when the trigger is a button\nconst TRIGGER_OFFSET = 8;\n// align offset when no inputLeftIcon\nconst INPUT_OFFSET_WITHOUT_LEFT_ICON = -12;\n// align offset with inputLeftIcon\nconst INPUT_OFFSET_WITH_LEFT_ICON = -40;\n\ntype PickerPopoverExtendedProps = Pick<StaticDatePickerProps, \"isRange\">\n\t& Pick<DatePickerInputProps, \"label\" | \"dateFormat\" | \"placeholder\" | \"inputLeftIcon\" | \"inputRightIcon\">\n\t& Pick<DateRangePickerInputProps, \"inputLeftIcon\" | \"inputRightIcon\">\n\t& Pick<StyledPopoverProps, \"$zIndex\">;\n\nexport type DatePickerPopoverProps = PickerPopoverExtendedProps & {\n\tdataQA: string;\n\tchildren?: ReactNode | JSX.Element[];\n\tdatesSelected?: StaticDatePickerProps[\"dayzedProps\"][\"selected\"];\n\t/**\n\t * @description closes the Popover when a date is selected\n\t * @default true\n\t */\n\tcloseOnDateSelected?: boolean;\n\tonDateChange?: (date?: Date | Date[]) => void;\n\t/**\n\t * @description trigger passed to the Popover which displays the DatePicker and DateRangePicker\n\t * @default <DatePickerInput/> for the single DatePicker\n\t * @default <DateRangePickerInput/> for the DateRangePicker\n\t */\n\ttrigger?: PopoverMenuProps[\"trigger\"];\n\tminDate?: Date;\n\tmaxDate?: Date;\n};\n\nconst DatePickerPopover = ({\n\tchildren,\n\ttrigger,\n\tdataQA,\n\tcloseOnDateSelected = true,\n\tdatesSelected,\n\tonDateChange,\n\tisRange,\n\tlabel,\n\tdateFormat,\n\tplaceholder,\n\tminDate,\n\tmaxDate,\n\tinputLeftIcon,\n\tinputRightIcon,\n\t$zIndex,\n}: DatePickerPopoverProps) => {\n\tconst [isCalendarOpen, setIsCalendarOpen] = useState(false);\n\t// this is needed to prevent the trigger from opening the calendar again if it was clicked\n\t// the onPointerDownOutside gets called before the onClick\n\tconst [outsideClicked, setOutSideClicked] = useState(false);\n\tconst datePickerInputRef = useRef<HTMLInputElement>(null);\n\tconst endDateInputRef = useRef<HTMLInputElement>(null);\n\n\tconst handleTriggerOnFocus = () => {\n\t\tsetIsCalendarOpen(true);\n\t};\n\n\tconst handleTriggerOnClick = () => {\n\t\tif (outsideClicked) {\n\t\t\tsetOutSideClicked(false);\n\t\t\treturn;\n\t\t}\n\t\tsetIsCalendarOpen(true);\n\t};\n\n\tconst closeCalendar = () => {\n\t\tsetIsCalendarOpen(false);\n\t};\n\n\tconst handleOnPointerDownOutside = (e: PointerDownOutsideEvent) => {\n\t\t// if input was clicked we don't need to close and can allow it to stay open\n\t\tif (datePickerInputRef.current === e.target || endDateInputRef.current === e.target) {\n\t\t\treturn;\n\t\t}\n\t\tsetOutSideClicked(true);\n\t\tcloseCalendar();\n\t};\n\n\tconst preventAutoFocus = (event: Event) => {\n\t\tif (!trigger && datePickerInputRef.current || endDateInputRef.current) {\n\t\t\tevent.preventDefault();\n\t\t}\n\t};\n\n\tconst handleOnOpenChange = (open: boolean) => !open && setOutSideClicked(false);\n\n\tuseEffect(() => {\n\t\tif (!closeOnDateSelected) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (isRange && datesSelected instanceof Array) {\n\t\t\tif (!isSameDay(datesSelected[0], datesSelected[1]) && datesSelected[1]) {\n\t\t\t\tcloseCalendar();\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tif (datesSelected && datesSelected instanceof Date) {\n\t\t\tcloseCalendar();\n\t\t}\n\t}, [datesSelected, closeOnDateSelected, isRange]);\n\n\tconst datePickerPopoverContext: DatePickerPopoverContextType = {\n\t\tcloseCalendarPopover: closeCalendar,\n\t};\n\n\t// this is needed to account for the inputLeftIcon since the Popover trigger is the start Input which\n\t// is indented from the visual input border\n\tconst getPopoverAlignOffset = () => {\n\t\tif (isRange && !trigger && !inputLeftIcon) {\n\t\t\treturn INPUT_OFFSET_WITHOUT_LEFT_ICON;\n\t\t}\n\t\t// this accounts for the size of the icon plus the additional padding\n\t\tif (inputLeftIcon) {\n\t\t\treturn INPUT_OFFSET_WITH_LEFT_ICON;\n\t\t}\n\t\treturn undefined;\n\t};\n\n\tconst renderInputTrigger = () => isRange ? (\n\t\t<DateRangePickerInput\n\t\t\tdataQA=\"range-input\"\n\t\t\tselectedDates={datesSelected instanceof Array ? datesSelected : undefined}\n\t\t\tid=\"range-input\"\n\t\t\tlabel={label}\n\t\t\tref={datePickerInputRef}\n\t\t\tendDateInputRef={endDateInputRef}\n\t\t\tonDateChange={onDateChange}\n\t\t\tplaceholder={placeholder}\n\t\t\tminDate={minDate}\n\t\t\tmaxDate={maxDate}\n\t\t\tinputLeftIcon={inputLeftIcon}\n\t\t\tinputRightIcon={inputRightIcon}\n\t\t/>\n\t) : (\n\t\t<DatePickerInput\n\t\t\tselectedDate={datesSelected instanceof Date ? datesSelected : undefined}\n\t\t\tsetIsCalendarOpen={setIsCalendarOpen}\n\t\t\tonDateChange={onDateChange}\n\t\t\tlabel={label}\n\t\t\tref={datePickerInputRef}\n\t\t\tdataQA={dataQA}\n\t\t\tdateFormat={dateFormat}\n\t\t\tplaceholder={placeholder}\n\t\t\tinputLeftIcon={inputLeftIcon}\n\t\t\tinputRightIcon={inputRightIcon}\n\t\t/>\n\t);\n\n\treturn (\n\t\t<DatePickerPopoverContextProvider value={datePickerPopoverContext}>\n\t\t\t<Popover\n\t\t\t\ttrigger={trigger || renderInputTrigger()}\n\t\t\t\ttriggerOnClick={handleTriggerOnClick}\n\t\t\t\ttriggerOnFocus={trigger ? undefined : handleTriggerOnFocus}\n\t\t\t\tariaLabel=\"datepicker popover\"\n\t\t\t\tdataQA={dataQA}\n\t\t\t\tradixPopoverProps={{\n\t\t\t\t\topen: isCalendarOpen,\n\t\t\t\t\tonOpenChange: handleOnOpenChange,\n\t\t\t\t}}\n\t\t\t\tradixPopoverContentProps={{\n\t\t\t\t\t// this is needed so that the offset is set correctly when using the Input\n\t\t\t\t\tsideOffset: !trigger ? INPUT_OFFSET : TRIGGER_OFFSET,\n\t\t\t\t\talignOffset: getPopoverAlignOffset(),\n\t\t\t\t\tonEscapeKeyDown: closeCalendar,\n\t\t\t\t\tonPointerDownOutside: handleOnPointerDownOutside,\n\t\t\t\t\tonOpenAutoFocus: preventAutoFocus,\n\t\t\t\t\tonCloseAutoFocus: preventAutoFocus,\n\t\t\t\t}}\n\t\t\t\t$zIndex={$zIndex}\n\t\t\t>\n\t\t\t\t{children}\n\t\t\t</Popover>\n\t\t</DatePickerPopoverContextProvider>\n\t);\n};\n\nexport default DatePickerPopover;\n"]}